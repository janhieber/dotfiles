#!/bin/bash

CRITICAL=5
WARNING=15

# this works in combination with
# https://github.com/janhieber/batmon

# get battery
export LC_ALL=en_US.UTF8
TEXT=""
while read line
do
    VALUE=$(echo $line | cut -d ',' -f 2 | tr -d "% ")
    if [[ -z $VALUE ]]
    then
        TEXT="${TEXT}-/"
    else
        TEXT="${TEXT}${VALUE}%/"
    fi
done <<< $(acpi -b)

TEXT=${TEXT::-1}

# get runtime in minutes
RUNTIME=$(cat /tmp/batmon.txt)

if [[ ${RUNTIME} -lt 0 ]]
then
    TEXT="${TEXT} (CHR)"
else
    let MINUTES=RUNTIME%60
    let HOURS=RUNTIME/60
    TEXT="${TEXT} $(printf '(%i:%02i)' ${HOURS} ${MINUTES})"
fi

# print text
echo ${TEXT}
echo ${TEXT}

# print color, if needed
if [[ ${RUNTIME} -ne -1 ]]
then
    [[ ${RUNTIME} -lt ${CRITICAL} ]] && echo "#FF2C28" && exit 0
    [[ ${RUNTIME} -lt ${WARNING} ]] && echo "#FFAD2D" && exit 0
fi

exit 0

